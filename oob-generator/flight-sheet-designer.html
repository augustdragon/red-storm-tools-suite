<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flight Sheet Designer - Red Storm</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #2a2a2a;
      color: #f4f4f4;
    }
    
    .designer-container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background-color: #3a3a3a;
      border-radius: 8px;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .controls button {
      padding: 10px 20px;
      background-color: #4a5a4a;
      color: #f4f4f4;
      border: 1px solid #6a7a6a;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .controls button:hover {
      background-color: #5a6a5a;
    }
    
    .preview-frame {
      background: white;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    /* Print Preview Styles */
    @page {
      size: letter;
      margin: 0.5in;
    }
    
    .page-title {
      text-align: center;
      font-size: 14pt;
      font-weight: bold;
      margin-bottom: 12px;
      border-bottom: 2px solid black;
      padding-bottom: 3px;
      color: black;
    }
    
    .flight-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .flight-card {
      border: 2px solid black;
      padding: 6px;
      page-break-inside: avoid;
      background: white;
      max-width: 450px;
      color: black;
    }
    
    .flight-header {
      display: grid;
      grid-template-columns: 2fr 1.5fr 1fr 1fr;
      gap: 4px;
      margin-bottom: 4px;
      padding-bottom: 3px;
      border-bottom: 1px solid black;
    }
    
    .fuel-box {
      border: 1px solid #666;
      padding: 2px 4px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .fuel-circles-row {
      display: flex;
      gap: 2px;
    }
    
    .fuel-circle {
      width: 10px;
      height: 10px;
      border: 1px solid #666;
      border-radius: 50%;
      background: white;
    }
    
    .field {
      border: 1px solid #666;
      padding: 2px 4px;
      min-height: 18px;
    }
    
    .field-label {
      font-size: 7pt;
      color: #999;
      font-style: italic;
    }
    
    .field-value {
      font-weight: bold;
      font-size: 9pt;
    }
    
    .tasking-fuel-row {
      display: grid;
      grid-template-columns: 0.7fr 1.1fr 0.6fr;
      gap: 4px;
      margin-bottom: 5px;
    }
    
    .fuel-box {
      border: 1px solid #666;
      padding: 2px 4px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .fuel-label-value {
      display: flex;
      align-items: center;
      gap: 3px;
      font-size: 7pt;
      white-space: nowrap;
    }
    
    .fuel-label-value .field-label {
      margin: 0;
    }
    
    .fuel-label-value .fuel-value {
      font-weight: bold;
      font-size: 9pt;
    }
    
    .fuel-circles-container {
      display: flex;
      flex-direction: column;
      gap: 2px;
      flex: 1;
    }
    
    .fuel-circles-row {
      display: flex;
      gap: 2px;
    }
    
    .aircraft-section {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 4px;
      margin-bottom: 4px;
    }
    
    .aircraft-card {
      border: 1px solid #333;
      padding: 3px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 3px;
      position: relative;
    }
    
    .aircraft-top-row {
      display: flex;
      gap: 3px;
      position: relative;
    }
    
    .damage-status-container {
      position: absolute;
      right: 3px;
      top: 38px;
      border: 1px solid #666;
    }
    
    .damage-table {
      border-collapse: collapse;
      font-size: 6pt;
      font-weight: bold;
    }
    
    .damage-table td {
      border: 1px solid #666;
      padding: 0px 3px;
      text-align: center;
    }
    
    .damage-table .damage-label {
      padding: 0px 3px;
      text-align: center;
    }
    
    .damage-table .damage-cell {
      width: 24px;
      height: 8px;
      background: white;
    }
    
    .aircraft-stats {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 7pt;
      padding-left: 3px;
      padding-right: 60px;
    }
    
    .stat-row {
      display: flex;
      gap: 4px;
    }
    
    .stat-item {
      display: flex;
      gap: 2px;
    }
    
    .stat-label {
      font-weight: bold;
    }
    
    .rwr-jam-column {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-left: auto;
    }
    
    .speed-table {
      border: 1px solid #666;
      border-collapse: collapse;
      width: 100%;
      font-size: 6pt;
      margin-top: 2px;
    }
    
    .speed-table th,
    .speed-table td {
      border: 1px solid #666;
      padding: 1px 2px;
      text-align: center;
    }
    
    .speed-table th {
      background: #e0e0e0;
      font-weight: bold;
    }
    
    .radar-info {
      font-size: 6pt;
      line-height: 1.3;
      margin-top: 2px;
      display: flex;
      justify-content: space-between;
      gap: 4px;
    }
    
    .radar-left {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    
    .radar-right {
      display: flex;
      flex-direction: column;
      gap: 1px;
      align-items: flex-end;
    }
    
    .weapons-container {
      display: flex;
      flex-direction: column;
      gap: 2px;
      padding-left: 10px;
    }
    
    .weapon-line {
      font-size: 6pt;
      display: flex;
      justify-content: flex-end;
      gap: 2px;
    }
    
    .weapon-label {
      font-weight: bold;
      text-align: right;
    }
    
    .weapon-value {
      font-weight: normal;
    }
    
    .crew-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0px;
      font-size: 6pt;
      position: absolute;
      right: 3px;
      top: 3px;
    }
    
    .crew-icon {
      font-size: 16pt;
      filter: grayscale(100%) brightness(0%);
    }
    
    .crew-count {
      border: 1px solid #666;
      padding: 1px 4px;
      font-size: 7pt;
      font-weight: bold;
      background: white;
      min-width: 10px;
      text-align: center;
    }
    
    .speed-table {
      margin-top: 20px;
    }
    
    .ordnance-area {
      border: 1px solid #999;
      padding: 3px;
      min-height: 30px;
      background: #fafafa;
    }
    
    .ordnance-label {
      font-size: 6pt;
      color: #666;
      margin-bottom: 2px;
    }
    
    .ordnance-text {
      font-size: 7pt;
      font-weight: bold;
    }
    
    @media print {
      body {
        background: white;
        padding: 0;
      }
      
      .designer-container {
        max-width: none;
      }
      
      .header, .controls {
        display: none;
      }
      
      .preview-frame {
        padding: 0;
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
  <div class="designer-container">
    <div class="header">
      <h1>üé® Flight Sheet Designer</h1>
      <p>Design and test alternative flight sheet layouts</p>
    </div>
    
    <div class="controls">
      <button onclick="loadSampleData()">üìÑ Load Sample Flights</button>
      <button onclick="window.print()">üñ®Ô∏è Print Preview</button>
      <button onclick="clearPreview()">üóëÔ∏è Clear</button>
      <button onclick="exportDesign()">üíæ Export HTML</button>
    </div>
    
    <div class="preview-frame" id="previewFrame">
      <div class="page-title">Red Storm - Flight Sheet (Sample)</div>
      <div class="flight-grid" id="flightGrid">
        <p style="color: #999; text-align: center; padding: 40px;">
          Click "Load Sample Flights" to preview the flight sheet design
        </p>
      </div>
    </div>
  </div>
  
  <script>
    // Sample flight data for testing
    const sampleFlights = [
      {
        id: 1,
        table: 'A',
        faction: 'NATO',
        tableName: 'NATO Table A - QRA Flight',
        result: 'US: 1 x {2} F-15C, CAP',
        debugText: '[Nation: 3 | Aircraft: 7]',
        timestamp: Date.now(),
        aircraft: 'F-15C',
        crew: 1,
        fuel: 15
      }
    ];
    
    // F-15C aircraft data
    const f15cData = {
      crew: 4,
      fuel: 15,
      gun: '+3 {2}',
      irm: '+3 {3}',
      rhm: '+3 {3}',
      rwr: 'C',
      jam: '3d',
      speeds: {
        'VH': { combat: 'N/A', dash: 'N/A', maneuver: 'N/A' },
        'H': { combat: '5', dash: '8', maneuver: '9' },
        'M': { combat: '4', dash: '6', maneuver: '9' },
        'L/D': { combat: '4', dash: '5', maneuver: '8' }
      },
      radar: 'LD TS [30]',
      radarModifier: '24+ : -1'
    };
    
    function loadSampleData() {
      const grid = document.getElementById('flightGrid');
      grid.innerHTML = '';
      
      sampleFlights.forEach(flight => {
        grid.appendChild(createFlightCard(flight));
      });
    }
    
    function createFlightCard(flight) {
      const card = document.createElement('div');
      card.className = 'flight-card';
      
      // Parse the result to extract flight information
      const resultLines = flight.result.split('<br>');
      const firstLine = resultLines[0];
      
      // Extract nation and aircraft from the first line
      const match = firstLine.match(/^([^:]+):\s*(\d+)\s*x\s*{(\d+)}\s*([^,]+),\s*(.+)$/);
      
      let nation = 'Unknown';
      let flightCount = '1';
      let flightSize = '2';
      let aircraft = 'Unknown';
      let tasking = 'CAP';
      
      if (match) {
        nation = match[1].trim();
        flightCount = match[2];
        flightSize = match[3];
        aircraft = match[4].trim();
        tasking = match[5].trim();
      }
      
      card.innerHTML = `
        <div class="flight-header">
          <div class="field">
            <div class="field-label">Callsign</div>
            <div class="field-value"></div>
          </div>
          <div class="field">
            <div class="field-label">Aircraft</div>
            <div class="field-value">${aircraft}</div>
          </div>
          <div class="field">
            <div class="field-label">Counter</div>
            <div class="field-value"></div>
          </div>
          <div class="field">
            <div class="field-label">Aggr.</div>
            <div class="field-value"></div>
          </div>
        </div>
        
        <div class="tasking-fuel-row">
          <div class="field">
            <div class="field-label">Tasking</div>
            <div class="field-value">${tasking}</div>
          </div>
          <div class="fuel-box">
            <div class="fuel-label-value">
              <span class="field-label">Fuel</span>
              <span class="fuel-value">${flight.fuel || 18}</span>
            </div>
            <div class="fuel-circles-container">
              <div class="fuel-circles-row">
                ${Array(Math.ceil((flight.fuel || 18) / 2)).fill(0).map(() => 
                  `<div class="fuel-circle"></div>`
                ).join('')}
              </div>
              <div class="fuel-circles-row">
                ${Array(Math.floor((flight.fuel || 18) / 2)).fill(0).map(() => 
                  `<div class="fuel-circle"></div>`
                ).join('')}
              </div>
            </div>
          </div>
          <div class="field">
            <div class="field-label">Notes</div>
            <div class="field-value">A, C, M, P</div>
          </div>
        </div>
        
        <div class="aircraft-section">
          ${Array(parseInt(flightSize)).fill(0).map((_, i) => `
            <div class="aircraft-card">
              <div class="crew-info">
                <span class="crew-icon">üßç</span>
                <div class="crew-count">${f15cData.crew}</div>
              </div>
              <div class="damage-status-container">
                <table class="damage-table">
                  <tr>
                    <td class="damage-label">Dam</td>
                    <td class="damage-label">Crp</td>
                    <td class="damage-label">Dst</td>
                  </tr>
                </table>
              </div>
              <div class="aircraft-top-row">
                <div class="aircraft-stats">
                  <div class="weapons-container">
                    <div class="weapon-line">
                      <span class="weapon-label">Gun:</span>
                      <span class="weapon-value">${f15cData.gun}</span>
                    </div>
                    <div class="weapon-line">
                      <span class="weapon-label">IRM:</span>
                      <span class="weapon-value">${f15cData.irm}</span>
                    </div>
                    <div class="weapon-line">
                      <span class="weapon-label">RHM:</span>
                      <span class="weapon-value">${f15cData.rhm}</span>
                    </div>
                  </div>
                  <table class="speed-table">
                    <tr>
                      <th>Alt</th>
                      <th>C</th>
                      <th>D</th>
                      <th>M</th>
                    </tr>
                    ${Object.entries(f15cData.speeds).map(([alt, speeds]) => `
                      <tr>
                        <td><strong>${alt}</strong></td>
                        <td>${speeds.combat}</td>
                        <td>${speeds.dash}</td>
                        <td>${speeds.maneuver}</td>
                      </tr>
                    `).join('')}
                  </table>
                  <div class="radar-info">
                    <div class="radar-left">
                      <div><strong>Radar:</strong> ${f15cData.radar}</div>
                      <div style="padding-left: 38px;">${f15cData.radarModifier}</div>
                    </div>
                    <div class="radar-right">
                      <div class="stat-item">
                        <span class="stat-label">RWR:</span>
                        <span>${f15cData.rwr}</span>
                      </div>
                      <div class="stat-item">
                        <span class="stat-label">Jam:</span>
                        <span>${f15cData.jam}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="ordnance-area">
                <div class="ordnance-label">Ordnance</div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
      
      return card;
    }
    
    function extractOrdnance(resultLines) {
      // Extract ordnance from lines that contain it
      const ordnanceLines = resultLines.filter(line => line.includes('(') && line.includes(')'));
      if (ordnanceLines.length === 0) return 'Standard loadout';
      
      // Extract just the ordnance part (in parentheses)
      const ordnance = ordnanceLines.map(line => {
        const match = line.match(/\(([^)]+)\)/);
        return match ? match[1] : '';
      }).filter(Boolean);
      
      return ordnance.length > 0 ? ordnance.join(' / ') : 'Standard loadout';
    }
    
    function clearPreview() {
      document.getElementById('flightGrid').innerHTML = `
        <p style="color: #999; text-align: center; padding: 40px;">
          Click "Load Sample Flights" to preview the flight sheet design
        </p>
      `;
    }
    
    function exportDesign() {
      const previewFrame = document.getElementById('previewFrame');
      const htmlContent = `<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Red Storm - Flight Sheet</title>
  <style>
${document.querySelector('style').textContent}
  </style>
</head>
<body>
${previewFrame.innerHTML}
</body>
</html>`;
      
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'flight-sheet-design.html';
      a.click();
      URL.revokeObjectURL(url);
      
      alert('Design exported! You can open the file to see the standalone version.');
    }
    
    // Auto-load sample data on page load
    window.addEventListener('load', () => {
      setTimeout(loadSampleData, 500);
    });
  </script>
</body>
</html>
