<!DOCTYPE html>
<html>
<head>
    <title>Nationality Extraction Test</title>
</head>
<body>
    <h1>Nationality Extraction Test</h1>
    <button onclick="testNationalityExtraction()">Test Nationality Extraction</button>
    <div id="output"></div>

    <script>
        // Simulate the aircraft database
        const testAircraftDB = {
            "RF-35XD Draken": {
                "name": "RF-35XD Draken",
                "nation": "DK"
            },
            "BR.1150 Atlantic 2": {
                "name": "BR.1150 Atlantic 2", 
                "nation": "FRG"
            },
            "Tornado IDS": {
                "name": "Tornado IDS",
                "nation": "FRG"
            },
            "F-16A (DK)": {
                "name": "F-16A Fighting Falcon",
                "nation": "DK"
            }
        };

        // Replicate the extractNationalityCode logic from NATOTableD3
        function extractNationalityCode(aircraft, nationalityName) {
            console.log('NATIONALITY DEBUG:', {
                aircraft,
                nationalityName
            });
            
            // Check if aircraft has nationality in parentheses like "F-16A (DK)"
            const nationalityMatch = aircraft.match(/\(([^)]+)\)$/);
            if (nationalityMatch) {
                console.log('Found explicit nationality in parentheses:', nationalityMatch[1]);
                return nationalityMatch[1];
            }
            
            // For multi-national raids, use aircraft database to determine nationality
            if (nationalityName === 'FRG/DK') {
                // Get aircraft data to check its nation - try multiple name variations
                const aircraftDB = testAircraftDB;
                let aircraftData = null;
                
                // Try exact match first
                aircraftData = aircraftDB[aircraft];
                console.log('Exact match result:', aircraftData);
                
                // If not found, try adding common suffixes
                if (!aircraftData) {
                    const commonSuffixes = [' Draken', ' Atlantic 2'];
                    for (const suffix of commonSuffixes) {
                        const extendedName = aircraft + suffix;
                        if (aircraftDB[extendedName]) {
                            aircraftData = aircraftDB[extendedName];
                            console.log('Found aircraft with extended name:', extendedName);
                            break;
                        }
                    }
                }
                
                // If still not found, try removing common words/suffixes
                if (!aircraftData) {
                    const simplifiedName = aircraft.replace(/\s+(Atlantic\s+\d+|Draken)$/i, '');
                    if (simplifiedName !== aircraft && aircraftDB[simplifiedName]) {
                        aircraftData = aircraftDB[simplifiedName];
                        console.log('Found aircraft with simplified name:', simplifiedName);
                    }
                }
                
                console.log('Aircraft database lookup for', aircraft, ':', aircraftData);
                
                if (aircraftData && aircraftData.nation) {
                    // Check if the aircraft's nation matches one of the raid nations
                    const raidNations = ['FRG', 'DK'];
                    console.log('Aircraft nation from DB:', aircraftData.nation, 'Raid nations:', raidNations);
                    if (raidNations.includes(aircraftData.nation)) {
                        console.log('Using aircraft DB nation:', aircraftData.nation);
                        return aircraftData.nation;
                    }
                }
                
                // Fallback: default to FRG for FRG/DK raids
                console.log('Defaulting to FRG for FRG/DK raid');
                return 'FRG';
            }
            
            return nationalityName;
        }

        function testNationalityExtraction() {
            console.log('=== NATIONALITY EXTRACTION TEST ===');
            
            const testCases = [
                { aircraft: 'F-16A (DK)', nationality: 'FRG/DK', expected: 'DK' },
                { aircraft: 'RF-35XD Draken', nationality: 'FRG/DK', expected: 'DK' },
                { aircraft: 'BR.1150 Atlantic 2', nationality: 'FRG/DK', expected: 'FRG' },
                { aircraft: 'Tornado IDS', nationality: 'FRG/DK', expected: 'FRG' }
            ];
            
            let results = '<h2>Test Results:</h2>';
            
            testCases.forEach(testCase => {
                const result = extractNationalityCode(testCase.aircraft, testCase.nationality);
                const success = result === testCase.expected;
                
                results += `
                    <div style="margin: 10px 0; padding: 10px; background: ${success ? '#d4edda' : '#f8d7da'};">
                        <strong>${testCase.aircraft}</strong> (${testCase.nationality})<br>
                        Expected: ${testCase.expected}, Got: ${result} 
                        ${success ? '✅' : '❌'}
                    </div>
                `;
                
                console.log(`${testCase.aircraft}: Expected ${testCase.expected}, Got ${result}`, success ? '✅' : '❌');
            });
            
            document.getElementById('output').innerHTML = results;
        }
    </script>
</body>
</html>