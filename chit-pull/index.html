<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Red Storm Initiative Chit Pull</title>
  <link rel="stylesheet" href="../shared/red-storm.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">Red Storm</div>
      <div class="subtitle">Initiative Chit Pull</div>
    </div>

    <a href="../" class="back-link">‚Üê Back to Red Storm Tools</a>

    <div class="main-content">
      <div class="fixed-section">
        <div class="result-container">
          <div id="chitDisplay" class="chit-display placeholder-chit">
            <div id="chitValue" class="chit-value placeholder-text">?</div>
            <div id="chitType" class="chit-type" style="display: none;"></div>
          </div>
        </div>

        <div class="button-container">
          <button class="button small-button" onclick="drawChit('small')">
            Draw Small
          </button>
          <button class="button large-button" onclick="drawChit('large')">
            Draw Large
          </button>
        </div>
      </div>

      <div class="scrollable-section">
        <div class="top-button-row">
          <button class="control-button history-button" onclick="toggleHistory()">
            <span id="historyButtonText">Draw History (0)</span>
          </button>
          <button class="control-button reset-button" onclick="clearHistory()">
            Clear History
          </button>
        </div>

        <div class="bottom-button-row">
          <button class="control-button links-button" onclick="toggleLinks()">
            <span id="linksButtonText">Links</span>
          </button>
        </div>

        <div id="historyContainer" class="history-container" style="display: none;">
          <div class="section-title">Draw History (Last 100)</div>
          <div id="historyContent">
            <div class="empty-history">No draws yet</div>
          </div>
        </div>

        <div id="linksContainer" class="links-container" style="display: none;">
          <div class="section-title">Red Storm Resources</div>
          <a href="https://www.gmtgames.com/p-1059-red-storm-2nd-printing.aspx" target="_blank" class="link-item">
            GMT Games - Official Product Page
          </a>
          <a href="https://talk.consimworld.com/WebX/.1ddc7afe/1" target="_blank" class="link-item">
            ConsimWorld Forum Discussion
          </a>
          <a href="https://boardgamegeek.com/boardgame/213497/red-storm-the-air-war-over-central-germany-1987" target="_blank" class="link-item">
            BoardGameGeek Page
          </a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Application state
    let selectedType = null;
    let drawnValue = null;
    let drawHistory = [];
    let showHistory = false;
    let showLinks = false;

    // Chit pools - these never change
    const chitPools = {
      small: [0, 0, 1, 1, 1, 2, 2, 2, 2, 3],
      large: [1, 2, 2, 2, 3, 3, 4, 4, 4, 5]
    };

    function drawChit(type) {
      const chits = chitPools[type];
      
      // Randomly select a chit (with replacement)
      const randomIndex = Math.floor(Math.random() * chits.length);
      const drawnChit = chits[randomIndex];
      
      // Add to draw history (limit to 100 items for performance)
      const historyEntry = {
        id: Date.now(),
        type,
        value: drawnChit
      };
      
      drawHistory.unshift(historyEntry);
      if (drawHistory.length > 100) {
        drawHistory = drawHistory.slice(0, 100);
      }
      
      drawnValue = drawnChit;
      selectedType = type;
      
      updateChitDisplay();
      updateHistoryButton();
      
      // Always update history content if the history container is visible
      const historyContainer = document.getElementById('historyContainer');
      if (historyContainer && historyContainer.style.display !== 'none') {
        updateHistoryContent();
      }
    }

    function updateChitDisplay() {
      const chitDisplay = document.getElementById('chitDisplay');
      const chitValue = document.getElementById('chitValue');
      const chitType = document.getElementById('chitType');
      
      if (drawnValue !== null) {
        // Show drawn chit
        chitDisplay.className = `chit-display ${selectedType}-chit`;
        chitValue.textContent = drawnValue;
        chitValue.className = `chit-value ${selectedType}-text`;
        chitType.textContent = selectedType === 'small' ? 'SM' : 'LG';
        chitType.className = `chit-type ${selectedType}-text`;
        chitType.style.display = 'block';
      } else {
        // Show placeholder
        chitDisplay.className = 'chit-display placeholder-chit';
        chitValue.textContent = '?';
        chitValue.className = 'chit-value placeholder-text';
        chitType.style.display = 'none';
      }
    }

    function toggleHistory() {
      if (!showHistory) {
        setShowLinks(false); // Close links when opening history
      }
      setShowHistory(!showHistory);
    }

    function toggleLinks() {
      if (!showLinks) {
        setShowHistory(false); // Close history when opening links
      }
      setShowLinks(!showLinks);
    }

    function setShowHistory(show) {
      showHistory = show;
      const container = document.getElementById('historyContainer');
      const buttonText = document.getElementById('historyButtonText');
      
      if (show) {
        container.style.display = 'block';
        buttonText.textContent = `Hide History (${Math.min(drawHistory.length, 100)})`;
        updateHistoryContent();
      } else {
        container.style.display = 'none';
        buttonText.textContent = `Draw History (${Math.min(drawHistory.length, 100)})`;
      }
    }

    function setShowLinks(show) {
      showLinks = show;
      const container = document.getElementById('linksContainer');
      const buttonText = document.getElementById('linksButtonText');
      
      if (show) {
        container.style.display = 'block';
        buttonText.textContent = 'Hide Links';
      } else {
        container.style.display = 'none';
        buttonText.textContent = 'Links';
      }
    }

    function updateHistoryButton() {
      const buttonText = document.getElementById('historyButtonText');
      const count = Math.min(drawHistory.length, 100);
      
      if (showHistory) {
        buttonText.textContent = `Hide History (${count})`;
      } else {
        buttonText.textContent = `Draw History (${count})`;
      }
    }

    function updateHistoryContent() {
      const content = document.getElementById('historyContent');
      
      if (drawHistory.length === 0) {
        content.innerHTML = '<div class="empty-history">No draws yet</div>';
      } else {
        const historyHTML = drawHistory.map((entry, index) => `
          <div class="history-item">
            <div class="history-number">#${drawHistory.length - index}</div>
            <div class="history-value ${entry.type}-text">${entry.value}</div>
            <div class="history-type">${entry.type === 'small' ? 'SM' : 'LG'}</div>
          </div>
        `).join('');
        
        content.innerHTML = `<div class="history-list">${historyHTML}</div>`;
      }
    }

    function clearHistory() {
      const wasShowingHistory = showHistory;
      drawHistory = [];
      drawnValue = null;
      selectedType = null;
      updateChitDisplay();
      updateHistoryButton();
      
      // Update history content if it's currently visible
      if (wasShowingHistory) {
        updateHistoryContent();
      }
    }

    // Initialize the app
    updateChitDisplay();
    updateHistoryButton();
  </script>
</body>
</html>